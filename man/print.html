<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Degenerate Programmer&#x27;s Manual</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="programming.html"><strong aria-hidden="true">2.</strong> Programming</a></li><li class="chapter-item expanded "><a href="rendering.html"><strong aria-hidden="true">3.</strong> Rendering</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Degenerate Programmer&#x27;s Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Degenerate is a programmable generative art engine. It is developed on
<a href="https://github.com/casey/degenerate/">GitHub</a> and deployed on the web at
<a href="https://degenerate.computer">degenerate.computer</a>.</p>
<p>Degenerate operates as a chain of image filters. The output of each filter is
used as the input of the next filter. Degenerate programs configure the state
of the current image filter and call <code>render()</code> to apply it.</p>
<p>Image filters have a number of properties, including a coordinate
transformation, which determines where in the input image pixels will be
sampled from; a signed distance field, which determines which of those pixels
will be modified; and a color transformation, which determines how those pixels
will be modified.</p>
<p>Try copying this example script into the text input field at
<a href="https://degenerate.computer">degenerate.computer</a>:</p>
<pre><code class="language-javascript">// Set the scale component of the current coordinate transformation
scale(0.75);
// Use the X signed distance field
x();
// Use a tenth-turn about the green color axis as the color transformation
rotateColor('green', 0.1 * TAU);
// Apply the current image filter
render();
</code></pre>
<p>Press the <code>Run</code> button or <code>Shift + Enter</code> to run it. Try running it repeatedly
to see the effects of iterated rendering.</p>
<p>For more information about the JavaScript and Rust programming API, see
<a href="programming.html">Programming</a>. For more details about how the rendering engine
works, see <a href="rendering.html">Rendering</a>.</p>
<h2 id="development"><a class="header" href="#development">Development</a></h2>
<p>Degenerate is developed on <a href="https://github.com/casey/degenerate/">GitHub</a>. If
you're interested in contributing, take a look at the codebase, and pop into
<a href="https://discord.gg/87cjuz4FYg">the Discord</a> for some suggestions for a good
first issue.</p>
<h2 id="suggestions"><a class="header" href="#suggestions">Suggestions</a></h2>
<p>Experiment, experiment, experiment! Clever combinations of commands craft
charming consequences. Check out and modify some examples by using the
drop-down menu in the upper right corner of the page. Try changing the filter
and rendering in a loop, or just mash <code>Shift + Enter</code> over and over again to
see what happens.</p>
<h2 id="saving-your-creations"><a class="header" href="#saving-your-creations">Saving your creations</a></h2>
<pre><code class="language-javascript">// Make the resolution nice and big
resolution(4096);
// Render something cool
x();
render();
// Save it
save();
</code></pre>
<h2 id="learning-javascript"><a class="header" href="#learning-javascript">Learning JavaScript</a></h2>
<p>An introduction to JavaScript is outside of the scope of this document. The
reader is referred to the excellent
<a href="https://developer.mozilla.org/en-US/">Mozilla Developer Network</a>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">introduction to JavaScript</a>,
<a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript">JavaScript tutorial</a>.
and
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference">JavaScript reference</a>.</p>
<h2 id="learning-rust"><a class="header" href="#learning-rust">Learning Rust</a></h2>
<p>An introduction to Rust is outside of the scope of this document. The reader is
referred to the excellent
<a href="https://doc.rust-lang.org/book/">Rust Book</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="programming"><a class="header" href="#programming">Programming</a></h1>
<p>Degenerate can be programmed using Rust or JavaScript.</p>
<h2 id="javascript-scripts"><a class="header" href="#javascript-scripts">JavaScript Scripts</a></h2>
<p>Degenerate scripts are written in JavaScript and sent to a Web Worker for
execution. The script then sends back a series of <code>Filter</code> objects from the
worker thread, which are used to configure image filters that the renderer
applies in the main thread.</p>
<p>The JavaScript API is concerned with setting properties of the current <code>Filter</code>
object, sending <code>Filter</code> objects to the main thread, and populating the sidebar
with interactive widgets.</p>
<p>Individual image filters are relatively simple, but iterated application of one
or more filters can produce surprising and beautiful results, and varying image
filters over time or applying the same image filter in a loop can yield
striking animations.</p>
<h2 id="rust-programs"><a class="header" href="#rust-programs">Rust Programs</a></h2>
<p>The Rust programming interface is undocumented.</p>
<h2 id="image-filter-properties"><a class="header" href="#image-filter-properties">Image Filter Properties</a></h2>
<p>Image filters read from a source image and write to a destination image. Every
time an image filter is applied, those images are swapped.</p>
<p>Image filters have a number of properties, including a coordinate
transformation, which determines whence input image pixels will be sampled; a
signed distance field, which determines which of those pixels will be modified;
and an color transformation, which determines how those pixels will be
modified.</p>
<p>For each pixel in the image, an image filter operates with roughly the
following steps:</p>
<ol>
<li>Generate the coordinates of the current pixel</li>
<li>Transform those coordinates by the current transform</li>
<li>If wrapping is enabled and the transformed pixel coordinates are out of
bounds, wrap them back in bounds</li>
<li>Sample the source image at those coordinates if they are in bounds,
otherwise use the current default color</li>
<li>If the pixel is inside of the current signed distance field, apply the color
transformation, otherwise use the original color</li>
<li>Save the generated pixel to the destination image</li>
</ol>
<h2 id="api"><a class="header" href="#api">API</a></h2>
<pre><code class="language-javascript">'use strict';

importScripts('gl-matrix-min.js', 'randchacha_browser.min.js');

glMatrix.glMatrix.setMatrixArrayType(Array);

let mat2 = glMatrix.mat2;
let mat2d = glMatrix.mat2d;
let mat3 = glMatrix.mat3;
let mat4 = glMatrix.mat4;
let quat = glMatrix.quat;
let quat2 = glMatrix.quat2;
let vec2 = glMatrix.vec2;
let vec3 = glMatrix.vec3;
let vec4 = glMatrix.vec4;

// Field that covers all pixels.
//
// ```
// all();
// render();
// ```
//
// All is the default field, so the above example could have been written
// as:
//
// ```
// render();
// ```
function all() {
  filter.field = 'All';
}

// Set the alpha blending factor. `alpha` will be used to blend the
// transformed color with the original color. See `www/fragment.glsl` for
// the blend equation.
//
// ```
// alpha(0.5);
// render();
// ```
function alpha(alpha) {
  filter.alpha = alpha;
}

// Assert that `condition` is true, otherwise throw `message`.
function assert(condition, message) {
  if (!condition) {
    throw message ?? 'assertion failed';
  }
}

// A checkerboard pattern.
//
// ```
// check;
// render();
// ```
function check() {
  filter.field = 'Check';
}

// Create a new checkbox widget with the label `name`, and return true if it is
// checked. Calls with same `name` will all refer to the same checkbox, making
// it safe to call repeatedly.
//
// ```
// while(true) {
//  reboot();
//  if (checkbox('x')) {
//    x();
//  } else {
//    circle();
//  }
//  await render();
// }
// ```
function checkbox(name) {
  self.postMessage(
    JSON.stringify({
      widget: {
        name,
        widget: 'checkbox',
      },
    })
  );
  return !!widgets['checkbox-' + name];
}

// A circle.
//
// ```
// circle();
// render();
// ```
function circle() {
  filter.field = 'Circle';
}

// Clear the canvas.
//
// ```
// check();
// render();
// clear();
// ```
function clear() {
  self.postMessage(JSON.stringify('clear'));
}

// A cross field.
//
// ```
// cross();
// render();
// ```
function cross() {
  filter.field = 'Cross';
}

// Set the decibel range for normalization of raw frequency data into values
// usable in the fragment shader. Frequency data, by default, is expressed in
// decibels. Decibels are logarithmic, with 0 representing the loudest possible
// sound, and -∞ representing the quietest possible sound. This is inconvenient
// and unintuitive to work with, so frequency data decibel values are
// normalized to values between 0 and 1, where 0 is the silence and 1 is loud.
// This normalization requires selecting cut-off min and max decibel values.
// Values below `min` are clamped to 0, and values above `max` are clamped to
// 1. Setting the min value too low will cause noise to appear in the
// normalized frequency data. Setting the min value too high will remove quiet
// sounds from the frequency data. Setting the max value too high will reduce
// the dynamic range of the normalized values, and setting the max value too
// low will clip loud sounds, causing them to all map to 1. The default range
// is [-100, -30], which is reasonable for most applications.
//
// ```
// equalizer()
// record();
// wrap(true);
// while(true) {
//   let min = slider('min', -300, 0, 1, -100);
//   let max = slider('max', -300, 0, 1, -30);
//   decibelRange(min, max);
//   clear();
//   await render();
// }
// ```
function decibelRange(min, max) {
  self.postMessage(JSON.stringify({ decibelRange: { min, max } }));
}

// Set the default color. The default color is returned whenever a pixel is sampled
// out of bounds due to a rotation, scale, or other sample coordinate transformation.
//
// ```
// defaultColor([255, 0, 255]);
// rotate(0.01 * TAU);
// render();
// ```
function defaultColor(defaultColor) {
  filter.defaultColor = defaultColor;
}

// Return the number of milliseconds that have elapsed between this frame and the last.
// Returns 0 for the first frame.
//
// ```
// let rotation = 0;
//
// while(true) {
//   reboot();
//   x();
//   rotation += delta() / 30000 * TAU;
//   rotate(rotation);
//   await render();
// }
// ```
function delta() {
  return lastDelta;
}

// Return the number of milliseconds that have elapsed since the page was loaded.
//
// ```
// while(true) {
//   reboot()
//   circle();
//   scale(0.75 * elapsed() / 20000);
//   await render();
// }
// ```
function elapsed() {
  return Date.now() - start;
}

// An equalizer pattern.
//
// ```
// record();
// equalizer();
// while(true) {
//   clear();
//   await render();
// }
// ```
function equalizer() {
  filter.field = 'Equalizer';
}

// Returns a promise that resolves when the browser is ready to display a new
// frame. Call `await frame()` in your rendering loop to only render when
// necessary and make sure each frame is displayed after rendering.
//
// ```
// scale(0.99);
// while (true) {
//   circle();
//   render();
//   x()
//   render();
//   await frame();
// }
// ```
async function frame() {
  await new Promise((resolve, reject) =&gt; {
    frameCallbacks.push(resolve);
  });
}

// A frequency field.
function frequency() {
  filter.field = 'Frequency';
}

// Set the color transformation to the identity transformation. The identity
// transformation returns the sampled pixel unchanged. Useful for applying
// transformations, such as scales or rotation, without changing the sampled
// pixels.
//
// ```
// identity();
// render();
// ```
function identity() {
  mat4.identity(filter.colorTransform);
}

// If `coordinates` is true, use the coordinate of the sample as the input color,
// instead of the color of the pixel in the source image. Defaults to false.
// Useful for creating gradients or debugging coordinate transforms.
//
// When true, RGB will be set to (x, y, 0)
//
// ```
// coordinates(true);
// render();
// ```
function coordinates(coordinates) {
  filter.coordinates = coordinates;
}

// Set the color transformation to inversion.
//
// ```
// x();
// invert();
// render();
// ```
//
// Inversion is the default color transformation, so the above example
// could have been written as:
//
// ```
// x();
// render();
// ```
function invert() {
  mat4.fromScaling(filter.colorTransform, vec3.fromValues(-1, -1, -1));
}

// Field that covers pixels where the pixel's index mod `divisor` is equal to `remainder`.
//
// ```
// mod(7,0);
// render();
// ```
function mod(divisor, remainder) {
  filter.field = { Mod: { divisor, remainder } };
}

// Set the oscillator gain. The oscillator produces a sine wave tone, useful
// for debugging audio-reactive scripts.
//
// ```
// equalizer()
// while(true) {
//   oscillatorFrequency(slider('frequency', 0, 20000, 1, 0));
//   oscillatorGain(slider('gain', 0, 1, 0.01, 0.25));
//   clear();
//   await render();
// }
// ```
function oscillatorGain(oscillatorGain) {
  self.postMessage(JSON.stringify({ oscillatorGain }));
}

// Set the oscillator frequency to `hz` hertz. The oscillator produces a sine wave tone,
// useful for debugging audio-reactive scripts.
//
// ```
// equalizer()
// while(true) {
//   oscillatorFrequency(slider('frequency', 0, 20000, 1, 0));
//   oscillatorGain(slider('gain', 0, 1, 0.01, 0.25));
//   clear();
//   await render();
// }
// ```
function oscillatorFrequency(oscillatorFrequency) {
  self.postMessage(JSON.stringify({ oscillatorFrequency }));
}

// Create a new radio button widget with the label `name` and options `options`,
// and return the selected option. `options` must be a list of strings. Calls with
// same `name` will all refer to the same radio button widget, making it safe to
// call repeatedly.
//
// ```
// while(true) {
//   reboot();
//   switch (radio('field', ['x', 'circle', 'cross'])) {
//     case 'x':
//       x();
//       break;
//     case 'circle':
//       circle();
//       break;
//     case 'cross':
//       cross();
//       break;
//   }
//   await render();
// }
// ```
function radio(name, options) {
  self.postMessage(
    JSON.stringify({
      widget: {
        name,
        widget: {
          radio: { options },
        },
      },
    })
  );
  return widgets['radio-' + name] ?? options[0];
}

// Reset the image filter and clear the canvas.
// ```
// x();
// render();
// reboot();
// ```
function reboot() {
  reset();
  clear();
}

// Enable audio recording.
function record() {
  self.postMessage(JSON.stringify('record'));
}

// Send the current filter to the main thread to be rendered. Like `frame()`,
// returns a promise that will resolve when the browser is ready to display a
// new frame. Use `await frame();` when you want to render multiple times before
// presenting a new frame, and `await render();` when you want to render once
// per frame.
//
// ```
// scale(0.99);
// circle();
// while (true) {
//   await render();
// }
// ```
async function render() {
  self.postMessage(JSON.stringify({ render: filter }));
  await frame();
}

// Reset the image filter.
//
// ```
// x();
// render();
// reset();
// ```
function reset() {
  filter = new Filter();
}

// Set resolution to a fixed value. Normally, the resolution increases and
// decreases automatically as the window is resized. This is usually what you
// want, but it is convenient to override it if you want to render at a fixed
// size, for example for saving high-resolution images:
//
// ```
// resolution(4096);
// x();
// render();
// save();
// ```
function resolution(resolution) {
  if (Number.isInteger(resolution)) {
    self.postMessage(JSON.stringify({ resolution }));
  }
}

// Use rotation as the color transformation.
//
// Valid values for `axis` are `red`, `green`, and `blue`. Applying `rotateColor` multiple
// times around different axes is a good way to get a variety of colors. Since `rotateColor`
// rotates the vector around the provided color axis, it will not change the amount of the
// axis's color. So if you want red, e.g., rotate about the `green` or `blue` axes.
//
// ```
// rotateColor('red', 0.5 * TAU);
// all();
// render();
// ```
function rotateColor(axis, radians) {
  switch (axis) {
    case 'red':
      mat4.fromXRotation(filter.colorTransform, radians);
      break;
    case 'green':
      mat4.fromYRotation(filter.colorTransform, radians);
      break;
    case 'blue':
      mat4.fromZRotation(filter.colorTransform, radians);
      break;
  }
}

// Set coordinate transform to a rotation.
//
// ```
// rotate(0.1);
// x();
// render();
// ```
function rotate(rotation) {
  transform(rotation, [1.0, 1.0], [0.0, 0.0]);
}

// Field that covers pixels where `pixel.y % (nrows + step) &lt; nrows`. Will cover `nrows` pixels and then
// skip `step` pixels.
//
// ```
// rows(1, 9);
// render();
// ```
function rows(on, off) {
  filter.field = { Rows: { on, off } };
}

// Save the current canvas as a PNG.
//
// ```
// resolution(4096);
// x();
// render();
// save();
// ```
function save() {
  self.postMessage(JSON.stringify('save'));
}

// Set the current scale to `scale`. The scale factor is applied to sample coordinates before
// looking up the pixel under those coordinates.
//
// ```
// circle();
// render();
// scale(0.5);
// render();
// ```
function scale(scale) {
  transform(0, [scale, scale], [0.0, 0.0]);
}

// Return a promise that resolves after `ms` milliseconds.
//
// ```
// circle();
// render();
// await sleep(1000);
// scale(0.5);
// render();
// ```
function sleep(ms) {
  return new Promise((resolve) =&gt; setTimeout(resolve, ms));
}

// Create a new slider widget with the given `name`, `min`, `max`, `step`, and
// `initial` values. Calls with same `name` will all refer to the same slider,
// making it safe to call repeatedly.
//
// ```
// x()
// while(true) {
//   rotateColor('green', slider('color rotation', 0, TAU, 0.001, 0));
//   clear();
//   await render();
// }
// ```
function slider(name, min, max, step, initial) {
  self.postMessage(
    JSON.stringify({
      widget: {
        name,
        widget: {
          slider: {
            min: min ?? 0,
            max: max ?? 1,
            step: step ?? 0.001,
            initial: initial ?? min ?? 0,
          },
        },
      },
    })
  );
  return widgets['slider-' + name] ?? initial;
}

// A square field.
//
// ```
// square();
// render();
// ```
function square() {
  filter.field = 'Square';
}

// A field that covers pixels where the audio time domain data is large.
function timeDomain() {
  filter.field = 'TimeDomain';
}

// Execute the filter `times` times.
function times(times) {
  filter.times = times;
}

// A field covering the top half of the canvas.
//
// ```
// top();
// render();
// ```
function top() {
  filter.field = 'Top';
}

// Set the coordinate transform using `rotation`, `scale`, and `translation`.
// Arguments that are omitted or undefined are skipped.
//
// ```
// circle();
// render();
// transform(TAU / 3, [2.0, 0.5], [0.1, 0.5]);
// render();
// ```
function transform(rotation, scale, translation) {
  mat3.identity(filter.positionTransform);
  mat3.rotate(filter.positionTransform, filter.positionTransform, rotation);
  mat3.scale(filter.positionTransform, filter.positionTransform, scale);
  mat3.translate(
    filter.positionTransform,
    filter.positionTransform,
    translation
  );
}

// A Waveform field.
//
// ```
// record();
// wave();
// while(true) {
//   clear();
//   await render();
// }
// ```
function wave() {
  filter.field = 'Wave';
}

// Set wrap. When `wrap` is `true`, out of bounds samples will be wrapped back within bounds.
//
// ```
// x();
// wrap();
// scale(0.1);
// render();
// ```
function wrap(warp) {
  filter.wrap = warp;
}

// An X field.
//
// ```
// x();
// render();
// ```
function x() {
  filter.field = 'X';
}

// The ratio of a circle's circumference to its diameter. Useful for expressing
// rotations in radians, where a full 360° turn is equal to `2 * PI`. For
// example, to rotate 1/4 turn, use `rotate(1/4 * 2 * PI)`.
const PI = Math.PI;

// The ratio of a circle's circumference to its radius. Useful for expressing
// rotations in radians, where a full 360° turn is equal to `TAU` For example,
// to rotate 1/4 turn, use `rotate(1/4 * TAU)`.
const TAU = Math.PI * 2;

class Rng {
  constructor(seed) {
    this.seed(0);
  }

  choose(array) {
    return array[this._rng.nextU32() % array.length];
  }

  seed(seed) {
    const _seed = new Uint8Array(32);
    _seed[0] = seed;
    this._rng = new randchacha.ChaChaRng(_seed);
  }
}

class Filter {
  constructor() {
    this.alpha = 1.0;
    this.colorTransform = mat4.fromScaling(
      mat4.create(),
      vec3.fromValues(-1, -1, -1)
    );
    this.positionTransform = mat3.create();
    this.coordinates = false;
    this.defaultColor = [0.0, 0.0, 0.0];
    this.field = 'All';
    this.times = 1;
    this.wrap = false;
  }
}

let frameCallbacks = [];
let lastDelta = 0;
let lastFrame = 0;
let rng = new Rng();
let start = Date.now();
let filter = new Filter();
let widgets = {};

self.addEventListener('message', async function (event) {
  const AsyncFunction = Object.getPrototypeOf(async function () {}).constructor;
  const message = JSON.parse(event.data);
  switch (message.tag) {
    case 'frame':
      for (let callback of frameCallbacks) {
        callback();
      }
      frameCallbacks = [];
      let now = Date.now();
      if (lastFrame &gt; 0) {
        lastDelta = now - lastFrame;
      }
      lastFrame = now;
      break;
    case 'script':
      frameCallbacks = [];
      try {
        await new AsyncFunction(message.content)();
      } catch (error) {
        self.postMessage(JSON.stringify({ error: error.toString() }));
      }
      self.postMessage(JSON.stringify('done'));
      break;
    case 'widget':
      widgets[message.content.key] = message.content.value;
      break;
  }
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rendering"><a class="header" href="#rendering">Rendering</a></h1>
<p>Degenerate programs are written in JavaScript and sent to a Web Worker for
execution. The program then sends back a series of <code>Filter</code> objects from the
worker, which are used to configure the renderer that runs in the main thread.
The renderer renders to a full-page <code>&lt;canvas&gt;</code> element using WebGL.</p>
<p>Rendering is performed by applying a series of image filters, with the output
of each filter being fed as input to the next.</p>
<p>The various parts of the renderer are described below. You may want to skip
ahead to the description of the fragment shader, which ties everything and
serves as a good jumping off point for the rest of the codebase.</p>
<h2 id="app"><a class="header" href="#app"><code>App</code></a></h2>
<p><code>App</code>, in <a href="https://github.com/casey/degenerate/blob/master/src/app.rs">app.rs</a>,
is the top-level struct which contains logic for configuring the application
responding to user-input.</p>
<h2 id="gpu"><a class="header" href="#gpu"><code>Gpu</code></a></h2>
<p><code>Gpu</code>, in <a href="https://github.com/casey/degenerate/blob/master/src/gpu.rs">gpu.rs</a>,
is responsible for setting up the WebGL context, updating the fragment shader
with values from <code>Filter</code> objects, and executing the rendering pipeline.</p>
<h2 id="vertex-shader"><a class="header" href="#vertex-shader">Vertex Shader</a></h2>
<p>The vertex shader, in
<a href="https://github.com/casey/degenerate/blob/master/src/vertex.glsl">vertex.glsl</a>,
emits a full-screen triangle.</p>
<h2 id="fragment-shader"><a class="header" href="#fragment-shader">Fragment Shader</a></h2>
<p>The fragment shader, in
<a href="https://github.com/casey/degenerate/blob/master/src/fragment.glsl">fragment.glsl</a>,
performs the bulk of the rendering by determining the color of each pixel of
the triangle produced by the vertex shader,</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
